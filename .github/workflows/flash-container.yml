name: flash-container
#
on:
  pull_request:
    branches: 
      - main
#
#  push:
#    branches: 
#      - development
#   
# A workflow run is made up of one or more jobs that can run sequentially or in parallel
#
jobs:
  #
  # Job 1
  #
  ubuntu-latest:
    name: "ubuntu-latest"
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2      
    - name: Dependencies1
      run: |
          sudo apt install apt-transport-https ca-certificates curl software-properties-common
          curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
          sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu \
                                   `lsb_release -cs` test"
          sudo apt update
          sudo apt install docker-ce
          docker run hello-world
    - name: Setup PyMaple
      run: |
          cd pymaple
          ./setup develop
          ./setup clean
    - name: Run examples/flashsim
      run: |
          cd examples/flashsim
          mkdir data
          ../../maple build
          ../../maple run --nprocs=1 && ../../maple rinse
          ../../maple clean
          ../../maple remove
          python3 MapleAPI.py
